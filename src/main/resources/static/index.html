<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/moment/min/moment.min.js"></script>
    <link href="bower_components/vis/dist/vis.css" rel="stylesheet" type="text/css" />
    <script src="bower_components/vis/dist/vis.min.js"></script>
    <script src="bower_components/angular-visjs/angular-vis.js"></script>
    <style type="text/css">
        .red {
          fill: red;
          font-size: 250%;
        }
        .normal {
          font-size: 250%;
        }
        body{
            width: 90vw;
            margin: 0 auto;
        }
    </style>

</head>
<body ng-app="weightApp" ng-controller="weightCtrl">
teste
{{firstName}}

<vis-graph2d data="data" options="options"></vis-graph2d>


<script>
            var app = angular.module('weightApp', ['ngVis']);
            app.controller('weightCtrl', function($scope, $http, VisDataSet) {

            var url = "weight?patient=rafael";

            $http.get(url).then(function(data){
                console.log("sucesso");
                console.log(data);
                var names = ['Weight'];
                var groups = new vis.DataSet();
                    groups.add({
                        id: 0,
                        content: names[0],
                        options: {
                            drawPoints: {
                                style: 'square' // square, circle
                            },
                            shaded: {
                                orientation: 'bottom' // top, bottom
                            }
                        }});


                      var label3 = {
                        content: "Label 3"
                      }

                    var items = [];

                    var lastValue = 0;

                    data.data.reverse().forEach(function(item, index){
                        console.log(item);

                        var today = new Date(item.weightDateTime.epochSecond * 1000);
                        var dd = today.getDate();
                        var mm = today.getMonth()+1; //January is 0!
                        var yyyy = today.getFullYear();

                        if(dd<10) {
                            dd = '0'+dd
                        }

                        if(mm<10) {
                            mm = '0'+mm
                        }

                       // today = yyyy + '-' + mm + '-' + dd;

                        console.log({x: today, y: item.value, group: 0, label: {content:item.value,  className: "red"}});

                        var cssclass = "normal";
                        if(Number(item.value) > lastValue){
                            cssclass = "red";
                        }

                        items.push({x: today, y: item.value, group: 0, label: {content:item.value,  xOffset: -52, className: cssclass}});

                        lastValue = item.value;
                    })

                    $scope.data = {items: new vis.DataSet(items), groups: groups};
                    $scope.options = {
                        dataAxis: {showMinorLabels: true} /* ,
                        legend: {left:{position:"bottom-left"}},
                        start: '2014-06-09',
                        end: '2014-07-03'
                        */
                    };

            }, function(error){
                console.log("ERRO");
                console.log(error);
            });



            });
        </script>
</body>
</html>
